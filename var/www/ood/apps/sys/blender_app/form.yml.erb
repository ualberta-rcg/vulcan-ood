<%
app_name = "Blender"
template_root = "/var/www/ood/apps/templates/"
gpu_data = {
  "gpu_types" => CustomGPUInfo.gpu_types,
  "gpu_name_mappings" => CustomGPUInfo.gpu_name_mappings.transform_keys(&:to_s),
  "gpu_max_counts" => CustomGPUInfo.gpu_max_counts.transform_keys(&:to_s)
}

# Define custom per-app min values
min_cores = 8 
min_mem_gb = 8
%>
---
javascript:
  - form.js

title: <%= app_name %>

attributes:
  gpudata:
    widget: hidden_field
    cacheable: false
    value: "<%= gpu_data.to_json.gsub('"','\\"') %>"

  memorydata:
    widget: hidden_field
    cacheable: false
    value: "<%= CustomClusterInfo.max_memory_per_node %>"

  min_cpu:
    widget: hidden_field
    value: "8"

  min_ram:
    widget: hidden_field
    value: "8"

  cpunum:
    widget: hidden_field
    cacheable: false
    value: "<%= CustomClusterInfo.max_cpus_per_node %>"

  cluster:
    widget: select
    label: Cluster
    options:
      - "<%= CustomClusterInfo.cluster_name %>"

  vnc_options:
    widget: hidden_field
    value: "+extension GLX +iglx"

  desktop:
    label: "Desktop Environment"
    widget: select
    options:
      - "none"
      - "gnome"
      - "mate"
      - "xfce"

  launch_app:
    widget: select
    label: Blender Version
    help: "Choose a Blender module to load for your environment."
    options:
      <% CustomAppVersions.blender_module_list.each do |label, value| %>
      - [ "<%= label %>", "<%= value %>", { data-hide-custom-environment: true } ]
      <% end %>

<% IO.foreach(template_root+"job_params") do |line| %><%= line %><% end %>


form:
  - cluster
  - bc_num_hours
  - desktop
  - launch_app
  - memorydata
  - cpunum
  - min_cpu
  - min_ram
<% IO.foreach(template_root+"form_params_app") do |line| %><%= line %><% end %>

